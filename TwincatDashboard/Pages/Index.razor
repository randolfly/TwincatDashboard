@page "/"
@using TwincatDashboard.Services.IService
@inject IAdsComService AdsComService
@inject ILogger<Index> Logger

<MTextField @bind-Value="_plcVarName" Label="Write Plc Symbol Name"/>
<MTextField @bind-Value="_plcVarValue" Type="number" Label="Write Plc Symbol Name"/>

<MButton OnClick="GetPlcValue">GetPlcValue: @PlcTestValue</MButton>

<MButton OnClick="SetPlcValue">SetPlcValue: @PlcTestValue With @_plcVarValue</MButton>

@code
{
    private string _plcVarName = string.Empty;
    private ushort _plcVarValue = 0;
    private uint? PlcTestValue { get; set; } = 0;
    
    private async Task GetPlcValue(MouseEventArgs arg)
    {
        await AdsComService.ReadPlcSymbolValueAsync<ushort>(_plcVarName).ContinueWith(task =>
        {
            if (task.IsCompletedSuccessfully)
            {
                PlcTestValue = task.Result;
            }
            else
            {
                Logger.LogError(task.Exception, "Error while getting plc value");
            }
        });
    }
    
    private async Task SetPlcValue(MouseEventArgs arg)
    {
        await AdsComService.WritePlcSymbolValueAsync(_plcVarName, _plcVarValue);
    }
}
